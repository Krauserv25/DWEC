<html>
	<head>
		<title>POSTAL DE NADAL</title>
		<script type="text/javascript" src="JS/kinetikJS.js"></script>
	</head>
	<body>
	    <div id="container" style="height:65%;"></div>
	    <script defer="defer">
	      var isInFloor = true;
	      var santa;
	      var scoreRegalos;
	      var maxPresents = 300;
	      var totalPresents = 0;

	      var stage = new Kinetic.Stage
	      ({
	        container: 'container',
	        width: 1250,
	        height: 433
	      });

	      var layer = new Kinetic.Layer();

	      var backgroundMountains1 = new Image();
	      var backgroundMountains2 = new Image();

	      backgroundMountains1.onload = function() 
	      {
	      		var back1 = new Kinetic.Image
		        ({
		          x: 0,
		          y: -250,
		          image: backgroundMountains1,
		          width: 1300,
		          height: 700
		        });

		     	layer.add(back1);

		     	backgroundMountains2.onload = function() 
		     	{
		     		var back2 = new Kinetic.Image
			        ({
			          x: 1300,
			          y: -250,
			          image: backgroundMountains2,
			          width: 1300,
			          height: 700
			        });

			     	layer.add(back2);

			     	var Back_Move = new Kinetic.Animation(function(frame) 
			        {
			        	var auxX_1 = back1.getX();
			        	var auxX_2 = back2.getX();

			        	back1.setX((auxX_1-10));
			        	back2.setX((auxX_2-10));

			        	if (back1.getX() <= -1300) 
		        		{
		        			back1.setX(1290);	        			
		        		}

		        		if (back2.getX() <= -1300) 
		        		{
		        			back2.setX(1290);	        			
		        		}
			        },layer);

			        Back_Move.start();
		     	}

		      var santaObj = new Image();

		      santaObj.onload = function() 
		      {
		        santa = new Kinetic.Image
		        ({
		          x: 0,
		          y: 300,
		          image: santaObj,
		          width: 106,
		          height: 118
		        });

		     	layer.add(santa);

		     	//SCORE JUEGO
		     	var scoreImage = new Image();
		     	
	     		var presentScore = new Kinetic.Image
		        ({
		          x: 50,
		          y: 10,
		          image: scoreImage,
		          width: 100,
		          height: 100
		        });

			    var ScoreRect = new Kinetic.Rect({
			        x: 50,
			        y: 20,
			        stroke: 'red',
			        strokeWidth: 5,
			        fill: '#ddd',
			        width: 390,
			        height: 80,
			        cornerRadius: 10
			      });

				 scoreRegalos = new Kinetic.Text({
				    x: 185,
				    y: 27,
				    text: '0/300',
				    fontSize: 70,
				    fontFamily: 'Arial',
				    fill: 'black'
				  });

				 layer.add(ScoreRect);
				 layer.add(presentScore);
				 layer.add(scoreRegalos);

				 //VIDAS JUEGO
		     	var lifeImage = new Image();
		     	
	     		var vida1 = new Kinetic.Image
		        ({
		          x: 900,
		          y: 10,
		          image: lifeImage,
		          width: 100,
		          height: 100
		        });	

		        var vida2 = new Kinetic.Image
		        ({
		          x: 1000,
		          y: 10,
		          image: lifeImage,
		          width: 100,
		          height: 100
		        });		

		        var vida3 = new Kinetic.Image
		        ({
		          x: 1100,
		          y: 10,
		          image: lifeImage,
		          width: 100,
		          height: 100
		        });					 

			 	var LifesRect = new Kinetic.Rect({
		        x: 900,
		        y: 20,
		        stroke: 'red',
		        strokeWidth: 5,
		        fill: '#ddd',
		        width: 300,
		        height: 80,
		        cornerRadius: 10
		      });

			 layer.add(LifesRect);
			 layer.add(vida1);
			 layer.add(vida2);
			 layer.add(vida3);

		     	setPresent();

		     	stage.add(layer);

		     	var Left_Move = new Kinetic.Animation(function(frame) 
		        {
		        	var auxX = santa.getX();
		        	santa.setX((auxX-10));
		        },layer);

		     	var Right_Move = new Kinetic.Animation(function(frame) 
		        {
		        	var auxX = santa.getX();
		        	santa.setX((auxX+10));
		        },layer);

		        var Up_Move = new Kinetic.Animation(function(frame) 
		        {
		        	var auxY = santa.getY();
		        	santa.setY((auxY-10));
		        },layer);

		     	var Down_Move = new Kinetic.Animation(function(frame) 
		        {
		        	var auxY = santa.getY();
		        	santa.setY((auxY+10));
		        },layer);

		        var Jump_UP = new Kinetic.Animation(function(frame) 
		        {
		        	var auxY = santa.getY();
		        	santa.setY((auxY-3));
		        },layer);

		       	var Jump_DOWN = new Kinetic.Animation(function(frame) 
		        {
		        	var auxY = santa.getY();
		        	santa.setY((auxY+3));
		        },layer);

			    window.addEventListener('keydown', function(e) 
				{
					var auxX = santa.getX();
					var auxY = santa.getY();

					switch (e.keyCode)
					{
						case 65: //LEFT
						if (auxX > 2)
						{
							Right_Move.stop();
							Left_Move.start();
						}
						else Left_Move.stop();
						break;

						case 68: //RIGHT
						if (auxX < 1000)
						{
							Left_Move.stop();
							Right_Move.start();
						}
						else Right_Move.stop();
						break;

						case 87: //UP
						if (auxY > 0)
						{
							Down_Move.stop();
							Up_Move.start();
						}
						else Up_Move.stop();
						break;

						case 83: //DOWN
						if (auxY < stage.getHeight())
						{
							Up_Move.stop();
							Down_Move.start();
						}
						else Down_Move.stop();
						break;

						case 32: //SPACE
						if (isInFloor)
						{
							isInFloor = false;
							Jump_UP.start();
							setTimeout(function()
							{
								Jump_UP.stop();
								Jump_DOWN.start();
								setTimeout(function()
									{
										Jump_DOWN.stop();
										isInFloor = true;
									}, 200);
							},200);
						}
						break;
					}
				});

				window.addEventListener('keyup', function(e) 
				{
					switch (e.keyCode)
					{
						case 65: //LEFT
						Left_Move.stop();
						break;

						case 68: //RIGHT
						Right_Move.stop();
						break;

						case 87: //UP
						Up_Move.stop();
						break;

						case 83: //DOWN
						Down_Move.stop();
						break;
					}
				});

				scoreImage.src = 'img/regalo.png';
				lifeImage.src = 'img/vida.png';
			};

			santaObj.src = 'img/santa.png';
	}

	backgroundMountains1.src = 'img/backMountains3.png';
	backgroundMountains2.src = 'img/backMountains4.png';

	function setPresent ()
	{
		var auxX = Math.floor(Math.random()*(4000)+1000);
		var auxY = Math.floor(Math.random()*(200)+170);
		var auxWidth = Math.floor(Math.random()*(40)+25);
		var auxHeight = Math.floor(Math.random()*(26)+25);

		var colorBox = getColor(Math.floor(Math.random()*(6)+0));
		var colorLazo = getColor(Math.floor(Math.random()*(6)+0));

		while (colorLazo === colorBox) //Esto impide que el color del lazo sea el mismo que el de la caja
		{
			colorLazo = getColor(Math.floor(Math.random()*(6)+0));
		}
		
		var rect = new Kinetic.Rect({
	        x: auxX,
	        y: auxY,
	        width: auxWidth,
	        height: auxHeight,
	        fill: colorBox,
	        stroke: 'black',
	        strokeWidth: 4
	      });

		var lazoVertical = new Kinetic.Rect({
	        x: auxX+(auxWidth/3), //Empieza en un tercio del ancho de regalo
	        y: auxY,
	        width: (auxWidth/3),
	        height: auxHeight,
	        fill: colorLazo,
	        stroke: 'black',
	        strokeWidth: 1
		});

		var lazoHorizontal = new Kinetic.Rect({
	        x: auxX,
	        y: auxY+(auxHeight/3), //Empieza en un tercio del alto de regalo
	        width: auxWidth,
	        height: (auxHeight/3),
	        fill: colorLazo,
	        stroke: 'black',
	        strokeWidth: 1
		});

		var lazoSuperior = new Kinetic.Circle({
	        x: auxX+(auxWidth/3),
	        y: auxY-4,
	        radius: 8,
	        fill: 'transparent',
	        stroke: colorLazo,
	        strokeWidth: 4
      });

		var lazoInferior = new Kinetic.Circle({
	        x: auxX+(auxWidth/3)+(auxWidth/3),
	        y: auxY-4,
	        radius: 8,
	        fill: 'transparent',
	        stroke: colorLazo,
	        strokeWidth: 4
      });

		layer.add(rect);
		layer.add(lazoVertical);
		layer.add(lazoHorizontal);
		layer.add(lazoSuperior);
		layer.add(lazoInferior);

		var Present_Move = new Kinetic.Animation(function(frame) 
        {
        	var x_Rect = rect.getX();

        	if (x_Rect >= 0)
        	{
	        	var x_LazoVertical = lazoVertical.getX();
	        	var x_LazoHorizontal = lazoHorizontal.getX();
	        	var x_LazoSuperior = lazoSuperior.getX();
	        	var x_LazoInferior = lazoInferior.getX();

	        	rect.setX((x_Rect-10));
	        	lazoVertical.setX((x_LazoVertical-10));
	        	lazoHorizontal.setX((x_LazoHorizontal-10));
	        	lazoSuperior.setX((x_LazoSuperior-10));
	        	lazoInferior.setX((x_LazoInferior-10));

        		var collision = checkPresentCollision(rect.getX(), rect.getY());
        		if (collision)
	        	{
	        		totalPresents++;

	        		scoreRegalos.setText(totalPresents+"/300");
	        		rect.remove();
					lazoVertical.remove();
					lazoHorizontal.remove();
					lazoSuperior.remove();
					lazoInferior.remove();
					Present_Move.stop();
					setTimeout(function()
					{
						Present_Move.stop();
						setPresent();   	
					},2000);
	        	}
        	}
        	else
        	{
				rect.remove();
				lazoVertical.remove();
				lazoHorizontal.remove();
				lazoSuperior.remove();
				lazoInferior.remove();
				Present_Move.stop();

				setTimeout(function()
				{
					Present_Move.stop();
					setPresent();   	
				},2000);
        	}
        },layer);

		Present_Move.start();
	}

	function getColor (code)
	{
		var auxColor;

		switch(code)
		{
			case 0:
			auxColor = "red";
			break;

			case 1:
			auxColor = "green";
			break;

			case 2:
			auxColor = "orange";
			break;

			case 3:
			auxColor = "blue";
			break;

			case 4:
			auxColor = "yellow";
			break;

			case 5:
			auxColor = "purple";
			break;

			case 6:
			auxColor = "cyan";
			break;
		}

		return auxColor;
	}

	function checkPresentCollision (present_X, present_Y)
	{
		if (present_X >= santa.getX() && present_X <= (santa.getWidth() + santa.getX()) &&
			present_Y >= santa.getY() && present_Y <= (santa.getHeight() + santa.getY()))
			{
				return true;
			}
			
			return false;
	}


	    /*  var rect = new Kinetic.Rect({
	        x: 100,
	        y: 75,
	        width: 100,
	        height: 50,
	        fill: 'green',
	        stroke: 'black',
	        strokeWidth: 4
	      });

	            var circle = new Kinetic.Circle({
        x: stage.getWidth() / 2,
        y: stage.getHeight() / 2,
        radius: 70,
        fill: 'black',
        stroke: 'black',
        strokeWidth: 4
      });

	                  var wedge = new Kinetic.Wedge({
        x: stage.getWidth() / 2,
        y: stage.getHeight() / 2,
        radius: 70,
        angleDeg: 60,
        fill: 'green',
        stroke: 'black',
        strokeWidth: 4,
        rotationDeg: -120
      });


	      // add the shape to the layer
	      layer.add(rect);
	      layer.add(circle);
	      layer.add(wedge);

	      // add the layer to the stage
	      stage.add(layer);*/
	    </script>
	</body>
</html>